# RAG文档显示功能说明

## 功能概述

本次更新为法律分析工具添加了RAG检索文档显示功能，用户可以在对话界面右侧查看AI回答时检索到的相关法律文档。

## 主要特性

### 1. 检索文档保存
- 在每次问答时，系统会自动保存RAG检索到的相关法律文档
- 文档信息包括：来源、相似度分数、完整内容等
- 这些信息会与对话记录一起保存

### 2. 实时文档显示
- 在最新对话的右侧显示检索到的相关文档
- 每个文档以可折叠的形式展示
- 显示文档来源、相似度分数和完整内容

### 3. 历史记录查看
- 在对话历史中也能查看每次问答时检索到的文档
- 保持完整的问答上下文信息

## 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│                    最新对话                                │
├─────────────────────┬─────────────────────────────────────┤
│                     │                                     │
│   问题：...          │    📚 检索到的相关文档              │
│   回答：...          │                                     │
│   引用依据：...      │   文档 1: 刑法.txt (相似度: 0.85)   │
│                     │   [可展开查看完整内容]               │
│                     │                                     │
│                     │   文档 2: 民法.txt (相似度: 0.78)   │
│                     │   [可展开查看完整内容]               │
│                     │                                     │
└─────────────────────┴─────────────────────────────────────┘
```

## 技术实现

### 1. RAG系统增强
- 在 `rag_system.py` 中添加了 `format_retrieved_chunks_for_display()` 方法
- 检索结果包含更多元数据信息

### 2. 数据结构更新
- 对话记录新增 `retrieved_chunks` 字段
- 保存完整的检索文档信息

### 3. 前端界面优化
- 使用两列布局：左侧对话，右侧文档
- 文档以可折叠的expander形式展示
- 添加了专门的CSS样式美化文档显示

## 使用方法

1. **启动应用**：运行 `python start_backend.py` 启动后端服务
2. **上传案例文件**：在案例页面上传法律文档
3. **提问**：在问答区域输入法律问题
4. **查看结果**：系统会在右侧显示检索到的相关法律文档
5. **查看历史**：点击"查看历史"可以查看完整的对话记录和检索文档

## 测试功能

运行测试脚本验证功能：
```bash
python test_rag_display.py
```

## 注意事项

- 确保法条向量库已构建（运行 `python -m utils.rag_system build`）
- 检索文档的显示依赖于RAG系统的正常工作
- 文档内容以只读形式显示，不可编辑

## 未来改进

- 支持文档内容的搜索和过滤
- 添加文档相关性排序功能
- 支持文档内容的导出和分享
- 优化文档显示的响应式布局
